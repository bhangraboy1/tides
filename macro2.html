<html>
<head>
  <link rel ='stylesheet' type='text/css' href='https://bhangraboy1.github.io/tides/tidescss.css'>
  <title>TIDES - Macroeconomics</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.6.0/chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
</head>

<body>

<div class="header">
  <h1>TIDES</h1>
    The Indian Dataset for Economic and Social Sciences
    <BR>
      <A style="font-weight:bold" HREF="https://bhangraboy1.github.io/tides/index.html">Home</A> /
      <A style="font-weight:bold" HREF="https://bhangraboy1.github.io/tides/macro.html">Macro</A> /
      <A style="font-weight:bold" HREF="https://bhangraboy1.github.io/tides/macro2.html">Macro2</A> /
      <A style="font-weight:bold" HREF="https://bhangraboy1.github.io/tides/demographics.html">Demographics</A> /
      <A style="font-weight:bold" HREF="https://bhangraboy1.github.io/tides/examples.html">Examples</A>
 </div>

<H2>Macroeconomic Trends</H2>
<div class="intro"><P>It is very important to understand how incomes are growing within India and other countries as a whole and on a per capita basis. 
      We need to monitor consumption, investment, and labor force participation among other key macro variables as 
	these all have important implications on livelihoods.
  <BR>Nominal GDP on log scale over time
  <BR>Bar Chart of Share of World GDP over time
  <BR>PPP GDP on log scale over time
  <BR>Per Capita GDP

</P>
</div>
<HR>	
<div class="controls">
  <label for="mixX">Start Date</label>
  <input type="date"   id="minDate" value="1960-12-31">
  <div id="regionselector">
    <label><input type="checkbox" name="region" value="IND" checked>India</label>
    <label><input type="checkbox" name="region" value="CHN" checked>China</label>
    <label><input type="checkbox" name="region" value="BRICS">BRICS</label>
    <label><input type="checkbox" name="region" value="TOP6">Top 6</label>
    <label><input type="checkbox" name="region" value="SIM">Similar Income</label>
    <label><input type="checkbox" name="region" value="BRK">Breakout</label>
    <button onclick="updateChart()">Update Chart</button>	  
  </div>
</div>
<HR>

    <div class="chart-container">
      <div class="chart-box">
	<H2>Gross Domestic Product</H2>
	<P2>GDP is a measure of the monetary value of final goods and services that are produced within a country.</P2>
        <canvas id="chartCanvas0" width="600" height="600"></canvas>
	<H5>Source: World Bank Data accessed through WBGAPI. </H5>
      </div>
	    
      <div class="chart-box">
        <H2>GDP (Nominal) Per Capita in USD</H2>
	<P2>GDP per capita is a measure of individual income or the standard of living within a country.</P2>
        <canvas id="chartCanvas1" width="600" height="600"></canvas>
	<H5>Source: World Bank Data accessed through WBGAPI.</H5>
      </div>
    </div>
	
    <div class="chart-container">
      <div class="chart-box">
	<H2>Gross Domestic Product</H2>
	<P2>GDP is a measure of the monetary value of final goods and services that are produced within a country.
	</P2>
        <canvas id="chartCanvas3" width="600" height="600"></canvas>
	<H5>Source: World Bank Data accessed through WBGAPI. </H5>
      </div>
      <div class="chart-box">
        <H2>GDP (Nominal) Per Capita in USD</H2>
	<P2>GDP per capita is a measure of individual income or the standard of living within a country.</P2>
        <canvas id="chartCanvas4" width="600" height="600"></canvas>
	<H5>Source: World Bank Data accessed through WBGAPI.</H5>
      </div>
    </div>
	
    <div class="chart-container">
      <canvas id="chartCanvas5" width="100" height="60"></canvas>
    </div>
    <div class="chart-container">
      <canvas id="chartCanvas6" width="100" height="60"></canvas>
    </div>
    <div class="chart-container">
      <canvas id="chartCanvas7" width="100" height="60"></canvas>
    </div>
    <div class="chart-container">
      <canvas id="chartCanvas8" width="100" height="60"></canvas>
    </div>
    <div class="chart-container">
      <canvas id="chartCanvas9" width="100" height="60"></canvas>
    </div>
    <div class="chart-container">
      <canvas id="chartCanvas10" width="100" height="60"></canvas>
    </div>

// This is the new streamlined script that should show all the graphs
//
//
//
    <script>
	let charts = {}; // Store Charts Globally
	    
	function initializeChart(canvasId, data, labels, title, yAxisLabel) {
    		const ctx = document.getElementById(canvasId).getContext('2d');
		console.log('Data:', canvasId, data);

		if (charts[canvasId]) {
			charts[canvasId].destroy();
		}
   		charts[canvasId] = new Chart(ctx, {
		  	type: 'line',
       			data: {
            			labels: labels,
            			datasets: data
        		},
        		options: {
            			plugins: {
               				title: {
                				display: true,
                   				text: title,
                    				font: {
                        				size: 18
                    				}
                			},
                			subtitle: {
                    				display: true,
                    				text: 'Graph Subtitle',
                    				font: {
                        				size: 14
                    				}
                			}
            			},
            			scales: {
                			x: {
                    			type: 'time',
                    			time: {
                        			unit: 'year',
                        			stepSize: 2,
                        			displayFormats: {
                            				year: 'yyyy'
                       				}
                    			},
                    			title: {
                        			display: true,
                        			text: 'Year'
                    			}
                		},
                			y: {
	                			title: {
                        				display: true,
                        				text: yAxisLabel
                    				}
                			}
            			}
        		}
   	 	});
	}
    </script>
	
// Scalable Function to Assign Colors to each Country
    <script>
	function createRegionData(countries) {
		let dataTemplate = {
      		IND: { color: 'rgba(255, 103,  31,  1)', borderwidth: 3, pointradius: 3 },
		CHN: { color: 'rgba(238,  28,  37,  1)', borderwidth: 1, pointradius: 1 },
		BRA: { color: 'rgba(253, 220,   2,  1)', borderwidth: 1, pointradius: 1 },
		USA: { color: 'rgba(  0,   0, 128,  1)', borderwidth: 1, pointradius: 1 },
		GBR: { color: 'rgba(  1,  33, 105,  1)', borderwidth: 1, pointradius: 1 },
		JPN: { color: 'rgba(188,   0,  45,  1)', borderwidth: 1, pointradius: 1 },
		DEU: { color: 'rgba(255, 204,   0,  1)', borderwidth: 1, pointradius: 1 },
		RUS: { color: 'rgba( 28,  53, 120,  1)', borderwidth: 1, pointradius: 1 },
		ZAF: { color: 'rgba(  0, 122,  77,  1)', borderwidth: 1, pointradius: 1 },
		KOR: { color: 'rgba(100,  74,   0,  1)', borderwidth: 1, pointradius: 1 },
		BGD: { color: 'rgba(  0, 106,  78,  1)', borderwidth: 1, pointradius: 1 }
    	};
		
	return countries.reduce((acc, country) => {
        	acc[country] = { data: [], ...dataTemplate[country] };
        	return acc;
    	}, {});
	}

    </script>

    <script>
	let trillion = 1000000000000
        let initialLabels = [];
	let initialLabels0 = [];
	let initialLabels1 = [];
// SCALE: Defining Colors, Border Width, and Marker Size for each dataset
	let countries = ['IND', 'CHN', 'BRA', 'USA', 'GBR', 'JPN', 'DEU', 'RUS', 'ZAF', 'KOR', 'BGD'];
	let regionData0 = createRegionData(countries);
	let regionData1 = createRegionData(countries); 

// Fetching Data for GDP Graph
	fetch('https://raw.githubusercontent.com/bhangraboy1/tides/main/GDP.csv')
        .then(response => response.text())
        .then(csvData => {
            Papa.parse(csvData, {
                header: true,
                dynamicTyping: true,
                complete: function(parsedData) {
                    chartConfigs[0].labels  = parsedData.data.map(row => new Date(row['Date']));
		    initialLabels0 = chartConfigs[0].labels;

		    countries.forEach(country => {
			    regionData0[country].data = parsedData.data.map(row => row[`${country}_GDP`] / chartConfigs[0].scale);
		    });

		    const datasets0 = convertToDatasets(chartConfigs[0].data); //convert regionData to a datasets array
    		    initializeChart(chartConfigs[0].canvasId, datasets0, chartConfigs[0].labels, chartConfigs[0].title, chartConfigs[0].yAxisLabel);
		    
		    console.log('Parsed Dates:', chartConfigs[0].labels);
		}
	    });
	});
 
// Fetch Data for GDP Per Capita Graph
	fetch('https://raw.githubusercontent.com/bhangraboy1/tides/main/GDPP.csv')
        .then(response => response.text())
        .then(csvData => {
            Papa.parse(csvData, {
                header: true,
                dynamicTyping: true,
                complete: function(parsedData) {
                    chartConfigs[1].labels  = parsedData.data.map(row => new Date(row['Date']));
		    initialLabels1 = chartConfigs[1].labels;

		    countries.forEach(country => {
			    regionData1[country].data = parsedData.data.map(row => row[`${country}_GDPP`] / chartConfigs[1].scale);
		    });

		    const datasets1 = convertToDatasets(chartConfigs[1].data); //convert regionData to a datasets array
    		    initializeChart(chartConfigs[1].canvasId, datasets1, chartConfigs[1].labels, chartConfigs[1].title, chartConfigs[1].yAxisLabel);
		    
		    console.log('Parsed Dates:', initialLabels);
		}
	    });
	});
	    
	function convertToDatasets(rd) {
		return Object.keys(rd).map(region => ({
        		label: region,
        		data: rd[region].data,
        		borderColor: rd[region].color,
			backgroundColor: rd[region].color,
        		borderWidth: rd[region].borderwidth,
       			pointRadius: rd[region].pointradius,
        		fill: false
    		}));
	}
	    
// SCALE: This is all of the data that drives all of the charts	    
    	let chartConfigs = [
    		{
        		canvasId: 'chartCanvas0',
        		data: regionData0, 
        		labels: initialLabels0, 
       			title: 'Nominal GDP (Current USD, trillions)', 
        		yAxisLabel: 'Nominal GDP (USD, trillions)',
			scale: trillion
    		},
		{
        		canvasId: 'chartCanvas1',
        		data: regionData1, 
        		labels: initialLabels1, 
       			title: 'GDP (Nominal) Per Capita (USD)', 
        		yAxisLabel: 'USD',
			scale: 1
    		}
   	// Add more configurations here as needed
	];
    </script>
    <script>
	function createDatasets(regionData, initialLabels, selectedRegions, minDate) {
    		return [...new Set(selectedRegions)].map(region => ({
        		label: region,
        		data: regionData[region].data.filter((value, idx) => new Date(initialLabels[idx]) >= minDate),
        		borderColor: regionData[region].color,
        		backgroundColor: regionData[region].color,
        		borderWidth: regionData[region].borderwidth,
        		pointRadius: regionData[region].pointradius
    		}));
	}

        function updateChart() {
		// Get Selected Regions
		const selectedRegions = Array.from(document.querySelectorAll('input[name="region"]:checked')).map(checkbox => checkbox.value);
		if (selectedRegions.includes('BRICS')) {
			selectedRegions.push('BRA', 'IND', 'CHN', 'RUS', 'ZAF');
			selectedRegions.splice(selectedRegions.indexOf('BRICS'), 1);
		}
		if (selectedRegions.includes('TOP6')) {
			selectedRegions.push('USA', 'CHN', 'JPN', 'DEU', 'IND', 'GBR');
			selectedRegions.splice(selectedRegions.indexOf('TOP6'), 1);
		}
		if (selectedRegions.includes('SIM')) {
			selectedRegions.push('BGD');
			selectedRegions.splice(selectedRegions.indexOf('SIM'), 1);
		}
		if (selectedRegions.includes('BRK')) {
			selectedRegions.push('KOR');
			selectedRegions.splice(selectedRegions.indexOf('BRK'), 1);
		}
		// Filter by Start Date
		const minDate = new Date(document.getElementById('minDate').value);

		chartConfigs.forEach(chart => {
			const filteredLabels = chart.labels.filter(label => new Date(label) >= minDate);
			const datasets = createDatasets(chart.data, chart.labels, selectedRegions, minDate);
			initializeChart(chart.canvasId, datasets, filteredLabels, chart.title, chart.yAxisLabel);
		});
	} 
    </script> 

</body>
</html>
